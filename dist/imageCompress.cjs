"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const m=require("./file2image.cjs"),d={quality:.95,qualityRate:.05},h=(t,e,i)=>{const{naturalWidth:a,naturalHeight:n}=t,c=a/n;let l,s;return c>=1?(e>0?l=Math.min(a,e):l=a,s=l/c):(i>0?s=Math.min(n,i):s=n,l=s*c),{dw:Math.floor(l),dh:Math.floor(s),sw:a,sh:n}},w=(t,e,i,a)=>{const n=document.createElement("canvas"),c=n.getContext("2d"),{dw:l,dh:s,sw:r,sh:o}=h(t,e,i);return n.width=l,n.height=s,a&&(c.fillStyle=a,c.fillRect(0,0,l,s)),c.drawImage(t,0,0,r,o,0,0,l,s),n},g=async(t,e)=>new Promise(i=>{t.toBlob(a=>{i(a)},"image/webp",e)}),u=(t,e)=>{e=Object.assign({...d},e);const i=m.file2image(t);return new Promise((a,n)=>{i.onload=async()=>{const c=w(i,e.maxWidth,e.maxHeight,e.fileStyle),l=e.filetype??t.type,s=e.filename??t.name;let r,o=e.quality;do r=await g(c,o),o-=e.qualityRate;while(r?.size>e?.maxSize);if(r?.size>t?.size)return a(t);a(new File([r],s,{type:l}))},i.onerror=n})};exports.default=u;exports.imageCompress=u;
