"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const m=require("./file2image.cjs");require("./file2url.cjs");const u={maxWidth:0,maxHeight:0,maxSize:0},h=(s,e,l)=>{const{naturalWidth:r,naturalHeight:t}=s,i=r/t;let a,n;return i>=1?(e>0?a=Math.min(r,e):a=r,n=a/i):(l>0?n=Math.min(t,l):n=t,a=n*i),{dw:Math.floor(a),dh:Math.floor(n),sw:r,sh:t}},g=(s,e,l,r)=>{const t=document.createElement("canvas"),i=t.getContext("2d"),{dw:a,dh:n,sw:c,sh:d}=h(s,e,l);return t.width=a,t.height=n,r&&(i.fillStyle=r,i.fillRect(0,0,a,n)),i.drawImage(s,0,0,c,d,0,0,a,n),t},o=(s,e)=>{e=Object.assign({...u},e);const l=m.file2image(s);return document.body.appendChild(l),new Promise((r,t)=>{l.onload=()=>{const i=g(l,e.maxWidth,e.maxHeight,e.fileStyle),a=e.filetype??s.type,n=e.filename??s.name;document.body.appendChild(i),i.toBlob(c=>{c?c.size>s.size?r(s):r(new File([c],n,{type:a})):t(new Error("canvas toBlob return null"))},a,e.quality)},l.onerror=t})};exports.default=o;exports.imageCompress=o;
