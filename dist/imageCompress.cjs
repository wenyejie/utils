"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const m=require("./file2image.cjs");require("./file2url.cjs");const d={quality:.95,qualityRate:.05},h=(t,e,i)=>{const{naturalWidth:a,naturalHeight:n}=t,r=a/n;let l,s;return r>=1?(e>0?l=Math.min(a,e):l=a,s=l/r):(i>0?s=Math.min(n,i):s=n,l=s*r),{dw:Math.floor(l),dh:Math.floor(s),sw:a,sh:n}},w=(t,e,i,a)=>{const n=document.createElement("canvas"),r=n.getContext("2d"),{dw:l,dh:s,sw:c,sh:o}=h(t,e,i);return n.width=l,n.height=s,a&&(r.fillStyle=a,r.fillRect(0,0,l,s)),r.drawImage(t,0,0,c,o,0,0,l,s),n},g=async(t,e)=>new Promise(i=>{t.toBlob(a=>{i(a)},"image/webp",e)}),u=(t,e)=>{e=Object.assign({...d},e);const i=m.file2image(t);return new Promise((a,n)=>{i.onload=async()=>{const r=w(i,e.maxWidth,e.maxHeight,e.fileStyle),l=e.filetype??t.type,s=e.filename??t.name;let c,o=e.quality;do c=await g(r,o),o-=e.qualityRate;while(c?.size>e?.maxSize);if(c?.size>t?.size)return a(t);a(new File([c],s,{type:l}))},i.onerror=n})};exports.default=u;exports.imageCompress=u;
