"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const u=require("./local.cjs"),h=require("./session.cjs"),m=require("./isFunction.cjs"),l=require("./env.cjs"),c=require("./globalThis.cjs");require("./storage.cjs");require("./toRawType.cjs");require("./toTypeString.cjs");require("./objectToString.cjs");require("./decapitalize.cjs");const n="s-catch-request-",o=i=>n+i,r=i=>i==="local"?u.local:h.session,a=(i="local")=>{if(!l.inBrowser())return;const t=c.default[i+"Storage"];for(let e in t)e.indexOf(n)>=0&&t.removeItem(e)},g={storageMode:"local",immediate:!1,timeout:0};class s{loading;timestamp;options;storage;data;promise;constructor(t){this.loading=0,this.timestamp=0,this.options=Object.assign(g,t),this.options.storageMode!=="none"&&(this.storage=r(this.options.storageMode)),this.options.immediate&&this.get()}get(t=!1){if(!t){if(this.loading===2&&!this.isTimeout())return Promise.resolve(this.data);if(this.loading===1)return this.promise;if(this.options.storageMode!=="none"){const e=this.storage(this.getStorageName());if(e!==void 0&&(this.timestamp=e.timestamp,!this.isTimeout()))return this.data=e.value,this.loading=2,Promise.resolve(this.data)}}return this.loading=1,this.promise=this.options.method().then(e=>(m.isFunction(this.options.success)&&this.options.success(e),this.data=e,this.timestamp=Date.now(),this.options.storageMode!=="none"&&this.storage(this.getStorageName(),{value:this.data,timestamp:this.timestamp}),e)),this.promise}isTimeout(){return this.options.timeout>0&&Date.now()-this.timestamp>this.options.timeout}getStorageName(){return o(this.options.storageName)}remove(){this.storage&&this.storage(this.getStorageName(),null)}static create(t){return new s(t)}static remove(t,e="local"){r(e)(o(t),null)}static removeAll(t){(t===void 0||t==="local")&&a("local"),(t===void 0||t==="session")&&a("session")}}exports.CacheRequest=s;exports.default=s;
